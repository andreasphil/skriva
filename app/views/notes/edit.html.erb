<!-- Uses page-wide notes controller -->
<div class="notes" data-stimulus-controller="notes">
  <div class="notes-content">
    <div class="notes-sidebar">
      <div class="notes-sidebar__sticky-wrapper">
        <%= button_tag t('.saved'),
          class: ['button', 'note__status-button', 'disabled'],
          data: {
            stimulus_action: 'click->notes#save',
            stimulus_target: 'notes.saveButton'
          } %>
      </div>
    </div>

    <div class="notes-editor">
      <div class="note"
        data-stimulus-action="input->notes#onNoteInput"
        data-stimulus-target="notes.note">
        <%# TODO: Use HTML sanitizer instead for security reasons %>
        <%= @note.text.html_safe %>
      </div>

      <!-- Shadow form -->
      <div class="note__shadow-form">
        <%= form_with scope: :note,
          url: note_path,
          method: :patch,
          data: {
            stimulus_action:
              'ajax:send->notes#onSend ajax:success->notes#onSuccess ajax:error->notes#onError'
          } do |form| %>
          <div class="form__group">
            <%= form.text_area :text, class: 'form__input', data: { stimulus_target: 'notes.input' } %>
          </div>
          <%= form.submit class: ['button'], data: { stimulus_target: 'notes.submitButton' } %>
        <% end %>
      </div>
    </div>
  </div>
</div>
